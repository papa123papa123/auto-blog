# src/prompts_text/article_outline_prompt.py
import re

def create_article_outline_prompt(main_keyword: str, sub_keywords: list[str]) -> str:
    """
    【改善版 v2】
    収集したキーワード群の意図を汲み取り、AIが最適な構成案を設計するためのプロンプト。
    """
    sub_keywords_str = "\n".join(f"- {kw}" for kw in sub_keywords)

    prompt = f"""
# 指示
あなたは、読者の検索意図を的確に捉え、SEOに強い記事構成案を作成するプロの編集長です。
以下の【提供情報】を元に、読者の満足度を最大化する高品質なブログ記事の構成案をJSON形式で作成してください。

# 提供情報
- **メインキーワード:** {main_keyword}
- **読者の潜在的な興味・関心（キーワード候補リスト）:**
{sub_keywords_str}

# 絶対遵守のルール

## 構成案の基本方針
1.  **キーワードの網羅性:** 「キーワード候補リスト」に含まれるトピックや質問を可能な限り網羅し、読者がこの記事だけで全ての疑問を解決できるように構成してください。
2.  **論理的な流れ:** 読者が自然に読み進められるように、H2見出しとH3見出しを論理的な順序で配置してください。（例：基本情報 → 選び方 → おすすめ商品 → 応用情報）
3.  **魅力的な見出し:** 各見出しは、読者が「自分のための情報だ」と感じ、思わずクリックしたくなるような、具体的で魅力的な言葉を選んでください。

## 各要素の作成ルール
- **title (記事タイトル):**
  - メインキーワード「{main_keyword}」を必ず含めてください。
  - 読者の興味を引く、28～32文字程度の魅力的なタイトルにしてください。
- **meta_description (メタディスクリプション):**
  - 記事全体の内容を要約し、読者がクリックしたくなるような120文字程度の文章を作成してください。
- **tags (タグ):**
  - 記事に関連する重要なキーワードを5つ、カンマ区切りで挙げてください。
- **outline (記事構成):**
  - **H2見出し:** 
    - **2個作成してください。**
    - 読者の大きな疑問や関心に応える、記事の大きな章立てとなる見出しにしてください。
    - 少なくとも1つのH2見出しに、メインキーワード「{main_keyword}」を自然な形で含めてください。
  - **H3見出し:** 
    - **各H2の下に、6個ずつ作成してください（合計12個）。**
    - H2の内容をさらに具体的に深掘りする、詳細なトピックにしてください。
    - 「キーワード候補リスト」の単語を積極的に活用して作成してください。
    - **重要:** メインキーワード「{main_keyword}」に含まれる各単語（例：「夏」「お酒」「ピッタリ」など）は、H3見出しでは使用しないでください。これらの単語はタイトルとH2見出しに含める必要がありますが、H3見出しでは避けてください。

# 出力フォーマット
- **JSON形式のみ**で出力してください。説明や前置きは一切不要です。
- 以下のJSON構造に厳密に従ってください。

```json
{{
  "title": "（記事タイトル）",
  "meta_description": "（メタディスクリプション）",
  "tags": "タグ1,タグ2,タグ3,タグ4,タグ5",
  "outline": [
    {{
      "h2": "（1つ目のH2見出し）",
      "h3": [
        "（H3見出し1）",
        "（H3見出し2）",
        "（H3見出し3）",
        "（H3見出し4）",
        "（H3見出し5）",
        "（H3見出し6）"
      ]
    }},
    {{
      "h2": "（2つ目のH2見出し）",
      "h3": [
        "（H3見出し7）",
        "（H3見出し8）",
        "（H3見出し9）",
        "（H3見出し10）",
        "（H3見出し11）",
        "（H3見出し12）"
      ]
    }}
  ]
}}
```
"""
    return prompt
