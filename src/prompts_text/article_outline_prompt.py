# src/prompts_text/article_outline_prompt.py
import re

def create_article_outline_prompt(main_keyword: str, sub_keywords: list[str]) -> str:
    """
    高品質な見出し生成と厳格な構成ルールを両立させるためのプロンプトを作成する。
    """

    sub_keywords_str = "\n".join(f"- {kw}" for kw in sub_keywords)
    
    # メインキーワードを構成単語に分割し、禁止ワードリストを作成
    main_keyword_parts = re.split(r'[\s　]+', main_keyword.strip()) # 全角・半角スペースで分割
    forbidden_words_str = "、".join(f"「{part}」" for part in main_keyword_parts)

    prompt = f"""
# 指示
あなたは、与えられた設計図とルールに絶対的に従う、プロのSEOエディター兼コピーライターです。
あなたの仕事は、以下の【提供情報】と【絶対遵守のルール】に基づき、最高のブログ記事構成案をJSON形式で作成することです。

# 提供情報
- **メインキーワード:** {main_keyword}
- **記事作成のヒントとなるキーワード候補リスト:**
{sub_keywords_str}

# 絶対遵守のルール

## 記事構造の設計図
以下の設計図に厳密に従って、記事の構成案を作成してください。

- **H1: 記事タイトル**
  - ルール: メインキーワード「{main_keyword}」を含み、28～32文字で作成。

- **H2-1: 「{main_keyword}」の基本情報**
  - ルール: メインキーワード「{main_keyword}」の単語全てを完全に含めつつ、読者のメリットが一目でわかるような具体的で魅力的な文章にしてください。例：「{main_keyword}を徹底比較！後悔しない選び方」
  - **H3 (6個):**
    1.  **テーマ「定義/仕組み」:** 対象が何であるかを解説する見出し。
    2.  **テーマ「歴史/背景」:** 対象の成り立ちや背景を説明する見出し。
    3.  **テーマ「特徴/メリット」:** 主な利点や良い評判をまとめる見出し。
    4.  **テーマ「デメリット/注意点」:** 潜在的な課題や注意点を指摘する見出し。
    5.  **テーマ「FAQ/よくある質問」:** 読者が抱きがちな疑問に答える見出し。
    6.  **テーマ「重要性/なぜ知るべきか」:** この情報を知ることの価値を伝える見出し。

- **H2-2: 「{main_keyword}」の具体的な活用法**
  - ルール: メインキーワード「{main_keyword}」の単語全てを完全に含めつつ、読者のメリットが一目でわかるような具体的で魅力的な文章にしてください。例：「{main_keyword}を徹底比較！後悔しない選び方」
  - **H3 (6個):**
    7.  **テーマ「手順/流れ」:** 利用や参加のステップを解説する見出し。
    8.  **テーマ「準備/必要なもの」:** 事前に必要なものをリストアップする見出し。
    9.  **テーマ「事例/活用シーン」:** 具体的なケーススタディや利用場面を示す見出し。
    10. **テーマ「成功のコツ」:** うまく活用するためのヒントをまとめる見出し。
    11. **テーマ「失敗事例/回避策」:** よくある失敗とその対策を説明する見出し。
    12. **テーマ「まとめ」:** 記事全体を総括する見出し。

## H3見出しのキーワード【最重要ルール】
- **1番目から11番目までのH3見出し**には、以下の単語を**絶対に含めないでください（使用厳禁）:** {forbidden_words_str}
- **12番目（最後）のH3見出し**には、**必ず**メインキーワード「{main_keyword}」を含めてください。

## H3見出しの品質
- 各H3見出しは、上記のテーマに沿いつつ、「キーワード候補リスト」をヒントにして、読者がクリックしたくなるような自然で具体的な文章にしてください。

# 出力フォーマット
- **JSON形式のみ**で出力してください。説明文などは一切不要です。
- `outline` 配列には、必ず上記の設計図通りの2つのオブジェクトを入れてください。
- 各オブジェクトの `h3` 配列には、必ず6つの文字列を入れてください。

```json
{{
  "title": "（タイトル）",
  "meta_description": "（メタディスクリプション）",
  "tags": "タグ1,タグ2,タグ3,タグ4,タグ5",
  "outline": [
    {{
      "h2": "（H2-1の見出し）",
      "h3": [
        "（H3-1の見出し）",
        "（H3-2の見出し）",
        "（H3-3の見出し）",
        "（H3-4の見出し）",
        "（H3-5の見出し）",
        "（H3-6の見出し）"
      ]
    }},
    {{
      "h2": "（H2-2の見出し）",
      "h3": [
        "（H3-7の見出し）",
        "（H3-8の見出し）",
        "（H3-9の見出し）",
        "（H3-10の見出し）",
        "（H3-11の見出し）",
        "（H3-12の見出し（まとめ））"
      ]
    }}
  ]
}}
```
"""
    return prompt