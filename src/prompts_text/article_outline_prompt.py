# src/prompts_text/article_outline_prompt.py
import re

def create_article_outline_prompt(main_keyword: str, sub_keywords: list[str]) -> str:
    """
    1ターンで高品質なH3見出しを生成するための最適化されたプロンプト。
    自己修正ループを不要にし、具体的で魅力的な見出しを直接生成。
    汎用的で、あらゆるキーワードに対応可能。
    """

    sub_keywords_str = "\n".join(f"- {kw}" for kw in sub_keywords)
    
    # メインキーワードを構成単語に分割し、禁止ワードリストを作成
    main_keyword_parts = re.split(r'[\s　]+', main_keyword.strip())
    forbidden_words_str = "、".join(f"「{part}」" for part in main_keyword_parts)

    # キーワードの種類を判定して適切な例を生成
    examples = _generate_contextual_examples(main_keyword)

    prompt = f"""
# 指示
あなたは、SEOとユーザー体験を両立させるプロの記事構成設計者です。
以下の【提供情報】と【絶対遵守のルール】に基づき、1ターンで完璧な記事構成案をJSON形式で作成してください。

# 提供情報
- **メインキーワード:** {main_keyword}
- **関連キーワード候補:**
{sub_keywords_str}

# 絶対遵守のルール

## 記事構造（2つのH2セクション、各6つのH3）

### H2-1: 「{main_keyword}」の基本情報
**H3見出しのテーマと例（禁止ワード「{forbidden_words_str}」は使用厳禁）:**

1. **定義・仕組み**: 「基本的な仕組み」「原理と効果」「選び方の基本」
2. **特徴・メリット**: 「人気の理由」「他との違い」「使用シーン」
3. **種類・タイプ**: 「カテゴリ別の特徴」「選び方のポイント」「デザインの違い」
4. **注意点・デメリット**: 「使用時の注意」「よくある失敗」「選び方のコツ」
5. **よくある質問**: 「初心者向け解説」「購入前の確認事項」「使い方の疑問」
6. **選び方のポイント**: 「失敗しない選び方」「予算別の選択肢」「目的別の選び方」

### H2-2: 「{main_keyword}」の具体的な活用法
**H3見出しのテーマと例（禁止ワード「{forbidden_words_str}」は使用厳禁）:**

7. **購入・準備**: 「購入場所の選び方」「価格の相場」「必要なアクセサリー」
8. **使用方法**: 「効果的な使い方」「季節別の活用法」「シーン別の使い分け」
9. **メンテナンス**: 「お手入れ方法」「保管のコツ」「長持ちさせる方法」
10. **トラブル対処**: 「よくある問題」「解決方法」「予防策」
11. **アレンジ・カスタマイズ**: 「個性を出す方法」「組み合わせのコツ」「オリジナル化」
12. **まとめ**: 「{main_keyword}の総まとめ」（←最後のみメインキーワード使用可）

## 最重要ルール（必ず守ってください）

### 禁止ワードルール
- **H3-1〜H3-11**: 「{forbidden_words_str}」を絶対に使用しない
- **H3-12（まとめ）**: 必ずメインキーワード「{main_keyword}」を含める

### 品質ルール
- **具体性**: 抽象的な表現を避け、読者が行動したくなる具体的な表現
- **多様性**: 同じような内容の見出しを避け、12個で網羅的な内容
- **自然性**: 不自然な日本語や機械的な表現を避ける
- **魅力度**: 読者がクリックしたくなる魅力的な見出し
- **汎用性**: キーワードの種類に関係なく適用できる表現

### キーワード別の例示（参考にしてください）

{examples}

**重要**: 上記のルールを厳格に守り、1ターンで完璧な構成案を生成してください。
"""
    return prompt

def _generate_contextual_examples(main_keyword: str) -> str:
    """
    キーワードの種類に応じて適切な例を生成
    """
    keyword_lower = main_keyword.lower()
    
    # 商品・サービス系
    if any(word in keyword_lower for word in ['おすすめ', '比較', 'ランキング', '選び方', '購入']):
        return """
**商品・サービス系キーワードの例（禁止ワード不使用）:**
- 「効果と選び方の基本」「人気の理由と特徴」「種類別の選び方」
- 「購入時の注意点」「よくある失敗と対策」「予算別の選択肢」
- 「使用方法とコツ」「お手入れと保管方法」「トラブル対処法」
- 「カスタマイズのアイデア」「組み合わせの提案」「オリジナル化の方法」
"""
    
    # 方法・やり方系
    elif any(word in keyword_lower for word in ['やり方', '使い方', '方法', '手順', 'コツ']):
        return """
**方法・やり方系キーワードの例（禁止ワード不使用）:**
- 「基本的な手順と流れ」「準備と必要なもの」「効果的なアプローチ」
- 「よくある失敗と対策」「成功のポイント」「初心者向けの解説」
- 「応用と発展方法」「カスタマイズのコツ」「トラブル対処法」
- 「実践のアイデア」「組み合わせの提案」「オリジナル化の方法」
"""
    
    # 知識・情報系
    elif any(word in keyword_lower for word in ['とは', '意味', '効果', 'メリット', 'デメリット']):
        return """
**知識・情報系キーワードの例（禁止ワード不使用）:**
- 「基本的な定義と仕組み」「効果とメカニズム」「種類と特徴」
- 「メリットとデメリット」「使用シーンと活用法」「選び方のポイント」
- 「よくある疑問と回答」「実践での活用方法」「応用と発展」
- 「カスタマイズのアイデア」「組み合わせの提案」「総合的な活用」
"""
    
    # デフォルト（汎用的）
    else:
        return """
**汎用的な例（禁止ワード不使用）:**
- 「基本的な仕組みと効果」「特徴と選び方の基本」「種類とタイプの違い」
- 「使用時の注意点」「よくある失敗と対策」「選び方のポイント」
- 「効果的な活用法」「お手入れと管理方法」「トラブル対処法」
- 「カスタマイズのアイデア」「組み合わせの提案」「総合的な活用」
"""