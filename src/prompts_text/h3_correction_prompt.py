# src/prompts_text/h3_correction_prompt.py
from typing import List

def create_h3_correction_prompt(main_keyword: str, forbidden_words: List[str], incorrect_h3s: List[str]) -> str:
    """
    ルール違反のH3見出しを修正させるための、強力な指示プロンプトを生成する。
    """
    forbidden_words_str = "、".join(f"「{word}」" for word in forbidden_words)
    incorrect_h3s_str = "\n".join(f"- {h3}" for h3 in incorrect_h3s)

    prompt = f"""
# 指示
あなたは、与えられた指示を絶対に遵守する、高精度なテキスト編集AIです。
あなたの前回の回答には、重大なルール違反がありました。以下の【ルール】と【あなたの間違い】をよく読み、**H3見出しのみを**修正して、正しいJSONリストを生成してください。

# 最重要ルール
- **以下の単語は、最後の「まとめ」を除くH3見出しに絶対に含めてはいけません（使用厳禁）:** {forbidden_words_str}
- **これらの単語はタイトルとH2見出しには含める必要がありますが、H3見出しでは使用禁止です**

# あなたの間違い
- あなたが前回生成したH3見出しには、上記の禁止単語が含まれていました。
- **違反した見出しリスト:**
{incorrect_h3s_str}

# 修正タスク
- 上記の【あなたの間違い】でリストアップされたH3見出しを、**【最重要ルール】を厳守して**修正してください。
- **見出しの意図やテーマは変えずに**、禁止単語だけを別の表現に置き換えてください。
- 例：「夏のおつまみレシピ人気ランキングTOP5！」→「おつまみレシピ人気ランキングTOP5！」
- 修正後の11個の見出しと、最後のまとめ見出し（これはメインキーワード「{main_keyword}」を含む）を合わせた、**合計12個のH3見出しの完全なリスト**を生成してください。

# 出力フォーマット
- **JSON形式のリストのみ**を出力してください。説明や言い訳は一切不要です。
- リストには、修正後の12個のH3見出し（文字列）のみを含めてください。

```json
[
  "（修正後のH3見出し1）",
  "（修正後のH3見出し2）",
  "（修正後のH3見出し3）",
  "（修正後のH3見出し4）",
  "（修正後のH3見出し5）",
  "（修正後のH3見出し6）",
  "（修正後のH3見出し7）",
  "（修正後のH3見出し8）",
  "（修正後のH3見出し9）",
  "（修正後のH3見出し10）",
  "（修正後のH3見出し11）",
  "（メインキーワード「{main_keyword}」を含む、まとめのH3見出し12）"
]
```
"""
    return prompt
