# -*- coding: utf-8 -*-
# final_test.py

import os
from src.gemini_generator import GeminiGenerator
from dotenv import load_dotenv

def main():
    """
    新しい「思考プロセス」プロンプトの性能を評価するための、一度きりの分析用スクリプト。
    """
    load_dotenv()
    
    main_keyword = "ワークマン	空調服"
    
    related_suggests = """
    ワークマンで一番涼しいパンツは？
    ワークマンの冷感機能の効果は何ですか？
    ワークマンで首に巻く冷たいやつは何ですか？
    ワークマンのリカバリーウェアとは何ですか？
    冷感敷きパッドはなぜ冷たいのでしょうか？
    冷感インナーの効果は何ですか？
    持続冷感とは何ですか？
    ワークマンの電熱ベストはどのくらい使えますか？
    ワークマンのヒートアシストとは何ですか？
    氷撃インナーの効果とは？
    Q-maxの最高値はいくつですか？
    フリーズテックの効果とは？
    冷感タオルにはどんな効果があるのですか？
    冷感素材はなぜ冷たいのでしょうか？
    接触温冷感とは何ですか？
    空調服 涼しい ランキング
    ワークマン 空調服 バッテリーセット24v
    空調服 最強 24v
    ワークマン 空調服 バッテリーセット 値段
    空調服 コスパ最強
    空調服 おすすめ
    ワークマン 空調服 バッテリーセット24v 口コミ
    ワークマン 空調服 バートル
    空調服はベストと半袖のどちらがいいですか？
    空調服はなぜ禁止されているのですか？
    空調服より涼しい服は？
    空調服の下には何を着ればよいですか？
    空調服は熱中症対策になりますか？
    ワークマンで首に巻く冷たいやつは何ですか？
    空調服 何が1番涼しい？
    空調服は毎日洗うべきですか？
    ワークマンの空調服のブランドは？
    ワークマン 着るエアコン いくら？
    バートル19Vは何時間持つ？
    空調服の12Vと24Vの違いは何ですか？
    空調服がダメな理由は何ですか？
    空調服のバッテリーは何年くらい持ちますか？

    ベルトファンと空調服、どちらが涼しいですか？
    空調服は雨の日でも大丈夫ですか？
    ワークマンの防寒着は何度まで着られますか？
    空調服ってどうなの？
    ワークマンの製品が安い理由は何ですか？
    ワークマンでおすすめの防寒着は？
    空調服は何時間持つ？
    空調服の電気代はいくらですか？
    ワークマンが冷暖房を兼ね備えた「着るエアコン」とは？
    バートルはなぜ人気があるのですか？
    空調服にフードが付いているメリットは？
    バートルの寿命はどれくらいですか？
    ワークマンでバートルは売ってますか？
    ワークマンの空調服はどのくらい使えますか？
    バートル空調服2025は互換性がありますか？
    ワークマンは値引き販売をしないのはなぜですか？
    WORKMANとWORKMANプラスの違いは何ですか？
    ワークマンはどこの傘下ですか？
    水冷服と空調服のどちらがよいですか？
    空調服は体温を下げますか？
    ワークマン 着るエアコン いくら？
    ワークマンの会員になるとどんなメリットがありますか？
    ワークマンでサイズが合わなかった商品の返品はできますか？
    ワークマンの初期費用はいくらですか？
    ワークマンのライバル店は？
    カインズはどこの国に本社がありますか？
    ワークマンの昔の名前は？
    一度着用した服は返品できますか？
    ワークマンでレシートをなくしたら交換してもらえますか？
    ワークマンでクレジットカードは使えますか？
    """

    instructions = f"""
あなたは、アフィリエイトブログの収益を最大化する、経験豊富なコンテンツストラテジストです。
あなたの仕事は、ユーザーから提供された雑多なキーワード候補群を分析し、**テーマの重複を完全に排除**した上で、読者を購買へと導く、論理的で魅力的な12個の記事見出し（サブキーワード）を再構成することです。

# あなたの思考プロセス（このステップに厳密に従ってください）

1.  **ステップ1：テーマの特定**
    まず、提供された全キーワードを心の中で読み解き、どのような主要テーマ（例：価格、バッテリー性能、他ブランド比較、使い方、手入れ、インナー、禁止事項など）が存在するかを特定します。

2.  **ステップ2：グループ化と統合（最重要）**
    次に、特定したテーマごとに、関連する全てのキーワードをグループ化します。そして、**各グループから、そのグループ全体の意図を代表する、最も包括的で魅力的な単一の見出しを1つだけ作成します。** これにより、同じ内容の見出しが複数存在することを防ぎます。

3.  **ステップ3：構成と仕上げ**
    最後に、作成した見出しを、読者が自然に読み進められる論理的な順序（Know→Do→Buy）に並べ、12個の最終的なリストとして出力します。

# 最終的な見出しの品質要件

- **検索意図**: 収益化のため、「Buy（購買型）」と「Do（取引型）」の意図を持つ見出しを中心に構成してください。
- **重複の完全排除**: 同じ検索意図を持つ見出しが複数存在しないように、ステップ2で完全に統合してください。
- **自然な日本語**: 読者がクリックしたくなるような、自然で分かりやすい文章にしてください。
- **比較の促進**: 比較対象となる製品やサービスが存在する場合は、比較検討できる見出しを積極的に含めてください。
- **メインキーワードの自然な配置**: メインキーワード（「{main_keyword}」）の構成語を、不必要に繰り返さないでください。ブランド名などは、比較や価格など、本当に必要な箇所に限定してください。主語の省略も有効です。

# 入力データ
## メインキーワード:
{main_keyword}

## 関連キーワード候補群（ユーザー提供のサジェスト一覧や画像から読み取った内容）:
{related_suggests}

# 出力形式
- 完成した12個の見出しのみを、1行ずつ改行して出力してください。
- 説明、パート名、番号、その他の装飾は一切不要です。
"""

    try:
        print("[テスト開始] 新しいプロンプトでキーワードを生成します...")
        gemini = GeminiGenerator()
        result_headings = gemini.generate(instructions)
        
        print("\n--- 生成されたキーワード（テスト結果） ---")
        print(result_headings)
        
        with open("final_test_output.txt", "w", encoding="utf-8") as f:
            f.write(result_headings)
        print("\n[成功] 結果を 'final_test_output.txt' に保存しました。")

    except Exception as e:
        print(f"\n[エラー] テスト中にエラーが発生しました: {e}")

if __name__ == "__main__":
    main()
